# Docker

## 言葉の定義

- **コンテナ**: アプリケーションを実行するための、隔離された実行環境のこと。Nameをつけることができる。
    - OSレベルの仮想環境ではなく、１つのプロセスとして動作する仮想的な実行環境
        - 仮想OS技術と比較して、軽快に起動・動作する
        - 死んでも簡単に生き返らせることを想定している
    - Docker: コンテナを作成するツールで、最も標準的なもの
    - Kubernetes (K8s): 複数のコンテナを管理し、計算資源の有効活用を図るもの
- **イメージ**: コンテナを作成する際の雛形のこと。Tagをつけることができる。
    - Linuxの仮想プロセスを土台とする
- **リポジトリ**: あるユーザが管理する、複数のイメージが保存されている場所のこと。
    - 特定のコンテナの状態を、イメージとしてリポジトリにcommitすることができる
- **レジストリ**: 複数のユーザがリポジトリを保存するリモートの場所/サービスのこと。
    - 特定のリポジトリを、レジストリにpushできる
- **Dockerfile**: イメージを作成するための初期化ファイル
    - X コンテナ上で環境を整え、万全なイメージを作成して環境を構築
    - O 必要最低限の実行環境をDockerfileに記述する（コンテナは簡単に死ぬものと考える）
- **ネットワーク**: コンテナが属する、仮想的なネットワークを構築できる。
    - コンテナの名前からなる、ネットワークを構築できる
    - 同一ネットワークに属するコンテナ同士は「名前」で相手コンテナを知る（DNSサービスが走っている）
        - IPアドレスから「名前」の逆引きも可能（nslookup）
    - 異なるネットワーク同士は通信できない
    - 特定のコンテナに、物理環境のポート番号へのリクエストを処理させる、IPマスカレードのようなことも可能
- **永続ボリューム**: コンテナのハードディスクを、物理環境のハードディスクに対応づけ（マウント）して保存する場所のこと


# Kubernetes (K8s)

## 言葉の定義

K8sを使ってイメージからインスタンス化されたコンテナは、以下の３つに分類される。

- **ポッド**: Dockerコンテナと同様に、*自身を管理・制御する機構がない*もの
    - K8sでインスタンス化されたモノを特別に区別する呼び方
        - Dockerでイメージをインスタンス化したものをコンテナと呼んで区別している
        - ポッドは、複数のコンテナを含むことができる
    - 以下２つのコントローラを使わないで、ポッド単独で走らせることは有り得ない
        - コンテナレベルの自己回復機能はもっている
        - ポッドレベルでの自己回復機能はもっていない
            - ハードウェア障害など対応できない
            - このレベルに対応するために、以下２つのコントローラがある
- **デプロイメント**: サーバなど、*継続的に処理を走らせるポッド*を生成・管理・制御するコントローラ
    - 異常終了したら、複製して起動させる
    - 複製の数を制御する機能のみをもつ
        - 以下の４つの機能に分類される
            - スケール（コンテナ数の制御）
            - ロールアウト（新しいイメージに更新）
            - ロールバック（古いイメージに戻る）
            - 自己回復（ポッドレベルの障害を回復）
        - 「負荷分散の機能」はもっていない（負荷分散は「サービス」が提供する機能に属する）
- **ジョブ**: *バッチ処理をするポッド*を生成・管理・制御するコントローラ
    - ポッドでの処理が正常終了すれば完了する
    - 異常終了した場合はリトライする
    - 以上の制御を行うという点で、ポッドの上位的存在として実行される
    - cron処理などが、これに該当する


K8sで生成されるポッド、デプロイメント、および、ジョブに加え、以下の制御を加えることができる
（書籍の日本語に不明なところが多く、再度、見直す必要あり…）。

- **サービス**: どの範囲のネットワークにアクセスできるかの区分（名前が適切ではない…）
    - 以下の４つのタイプに分類される
        - ClusterIP: 同一ポッド内のネットワークにアクセス可能
        - NodePort: ClusterIPに加えて、ノードのIPアドレスとポート番号でアクセス可能
            - IPマスカレードされている、他のポッドのコンテナにアクセスできる？？？
        - LoadBalancer: NodePortに加えて、代表IPアドレスとデフォルトポート番号でアクセス可能
            - ポッドが走っているノードと同じネットワーク内のノードにアクセス可能？？？
        - ExternalName: DNSサーバを介して、外部のネットワークにアクセス可能？？？
- **イングレス**: ポッドが提供するサービスを外部のネットワークからアクセス可能にする
